<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>B–ÅAT ‚Äî –ú–∞–≥–∞–∑–∏–Ω –±–∏—Ç–æ–≤</title>
<style>
:root{--bg:#06070a;--panel:#0f1116;--panel-2:#141721;--panel-3:#1b1f2b;--border:rgba(255,255,255,.08);--muted:rgba(255,255,255,.65);--muted-2:rgba(255,255,255,.45);--accent-grad:linear-gradient(90deg,#4f46e5,#7c3aed,#a855f7);}*{box-sizing:border-box;margin:0;padding:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif}body{background:var(--bg);color:#fff;min-height:100vh;display:flex;flex-direction:column}.screen{max-width:520px;margin:0 auto;width:100%;display:flex;flex-direction:column;min-height:100vh}

/* EFFECTS / iOS FEEL */
.glass{backdrop-filter:blur(14px);-webkit-backdrop-filter:blur(14px)}
.shadow{box-shadow:0 18px 40px rgba(0,0,0,.45)}
.soft{transition:.25s ease}
.soft:active{transform:scale(.97)}
.fade{animation:fade .25s ease} @keyframes fade{from{opacity:.3;transform:translateY(6px)}to{opacity:1;transform:none}}

.top-bar{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;border-bottom:1px solid var(--border);background:linear-gradient(180deg,#0f1320,transparent)}
.brand{font-size:20px;font-weight:900}
.balance{display:flex;align-items:center;gap:6px;background:var(--panel-2);padding:6px 10px;border-radius:14px;border:1px solid var(--border)}
.balance button{background:var(--panel-3);border:1px solid var(--border);border-radius:8px;color:#fff;font-size:12px;padding:2px 6px;cursor:pointer}

.page{display:none;padding-bottom:120px}
.page.active{display:block}
.page-header{padding:12px 18px 6px;font-weight:800;font-size:18px}
.card-panel{background:var(--panel-2);border:1px solid var(--border);border-radius:18px;padding:14px;margin:0 18px 12px}

/* PROFILE ‚Äî HERO */
.profile-hero{position:relative;padding:24px 18px 18px;background:radial-gradient(100% 120% at 50% -10%,#242a60 0%,#0f1118 60%);border-bottom:1px solid var(--border)}
.profile-top{display:flex;flex-direction:column;align-items:center;margin-top:6px}
.p-avatar{width:96px;height:96px;border-radius:50%;overflow:hidden;border:2px solid rgba(255,255,255,.25)}
.p-avatar img{width:100%;height:100%;object-fit:cover}
.p-name{margin-top:10px;font-size:20px;font-weight:900}
.p-stats{display:flex;gap:28px;margin-top:10px}

.p-actions{display:flex;gap:10px;margin-top:14px}
.btn-primary{background:var(--accent-grad);border:none;border-radius:14px;padding:8px 14px;font-weight:800;color:#fff;cursor:pointer}
.btn-secondary{background:var(--panel-3);border:1px solid var(--border);border-radius:14px;padding:8px 14px;font-weight:800;color:#fff;cursor:pointer}
.btn-ghost{background:var(--panel-3);border:1px solid var(--border);border-radius:14px;padding:8px 10px;color:#fff;cursor:pointer}
.bio{margin-top:12px;font-size:12px;color:var(--muted-2);text-align:center}
.contact-pill{margin-top:8px;background:var(--panel-3);display:inline-block;padding:6px 10px;border-radius:20px;border:1px solid var(--border);font-size:12px}

/* TABS */
.tabs{display:flex;gap:16px;padding:10px 18px 0 18px;border-bottom:1px solid var(--border)}
.tab{padding:10px 0;font-size:13px;color:var(--muted);cursor:pointer}
.tab.active{color:#fff;border-bottom:2px solid #fff}

.list{padding:10px 18px 120px 18px;display:flex;flex-direction:column;gap:12px}
.row{display:grid;grid-template-columns:64px 1fr;background:var(--panel-2);border-radius:16px;border:1px solid var(--border);overflow:hidden}
.row img{width:100%;height:100%;object-fit:cover}
.row-body{padding:8px;display:flex;flex-direction:column;gap:4px}
.row-title{font-weight:800;font-size:14px}
.row-tag{font-size:11px;color:var(--muted-2)}
.row-foot{display:flex;justify-content:space-between;align-items:center}
.icon-btn{background:var(--panel-3);border:1px solid var(--border);border-radius:12px;padding:6px 8px;font-size:13px;color:#fff;cursor:pointer}
.like.active{color:#ff6b8b}

/* REVIEWS */
.review{background:var(--panel-2);border:1px solid var(--border);border-radius:16px;padding:10px}
.review-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.review-user{font-weight:700;font-size:13px}
.stars{color:#ffd977;font-size:13px}
.review-text{font-size:12px;color:#fff}

/* CHIPS & CATALOG */
.chip-row{display:flex;overflow-x:auto;gap:8px;padding:12px 18px}
.chip{padding:7px 14px;border-radius:999px;font-size:13px;background:var(--panel-2);border:1px solid var(--border);white-space:nowrap}
.chip.active{background:#fff;color:#000;border-color:#fff}
.section-title{font-size:14px;color:var(--muted);margin:0 18px 6px}

/* üé® –ù–û–í–´–ô –°–¢–ò–õ–¨ –î–õ–Ø –ö–ù–û–ü–û–ö –§–û–†–ú (iOS / Liquid) */
.submit{
  background:var(--panel-3);
  border:none;
  border-radius:16px;
  padding:12px 16px;
  color:#fff;
  font-weight:900;
  cursor:pointer;
  box-shadow:
    0 10px 26px rgba(120,60,255,.45),
    inset 0 1px 6px rgba(255,255,255,.25);
  transition:.25s ease, transform .15s ease;
}

/* üëá –§–ò–ö–° ‚Äî —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —Ñ–æ—Ä–º—ã –¥–æ –∫–Ω–æ–ø–∫–∏ */
.card-panel .submit{
  width:100%;
  margin-top:12px;     /* –±—ã–ª–æ –º–∞–ª–æ, —Å—Ç–∞–ª–æ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ */
}

/* ‚Äî‚Äî‚Äî –í–´–†–ê–í–ù–ò–í–ê–ù–ò–ï –°–¢–ê–¢–ò–°–¢–ò–ö–ò –ü–†–û–§–ò–õ–Ø ‚Äî‚Äî‚Äî */
.p-stats{
  display:grid;                /* –≤–º–µ—Å—Ç–æ flex */
  grid-template-columns:repeat(3,1fr);
  justify-items:center;
  align-items:center;
  gap:12px;
}

.stat{
  display:flex;
  flex-direction:column;
  align-items:center;
  text-align:center;
}

.stat strong{
  font-size:15px;
  font-weight:900;
}

.stat span{
  font-size:12px;
  color:var(--muted-2);
}


/* ‚¨á‚¨á‚¨á NEW LIQUID-GLASS NAV (iOS style) */
.nav{
  position:fixed;
  left:0;right:0;bottom:18px;
  max-width:520px;
  margin:0 auto;
  padding:10px 14px;
  border-radius:26px;
  border:1px solid rgba(255,255,255,.25);
  background:linear-gradient(
    180deg,
    rgba(255,255,255,.45) 0%,
    rgba(255,255,255,.22) 45%,
    rgba(10,10,12,.45) 100%
  );
  backdrop-filter:blur(26px) saturate(1.4);
  -webkit-backdrop-filter:blur(26px) saturate(1.4);
  box-shadow:
    0 20px 45px rgba(0,0,0,.55),
    inset 0 1px 6px rgba(255,255,255,.25);
  animation:floatDock .45s ease;
}

/* –ª—ë–≥–∫–∏–π —à—É–º –∫–∞–∫ –≤ iOS / visionOS */   /* ADDED */
.nav::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius:26px;
  background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='2'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.12'/%3E%3C/svg%3E");
  pointer-events:none;
}

@keyframes floatDock{
  from{transform:translateY(22px) scale(.96);opacity:.65}
  to{transform:none;opacity:1}
}

/* –∞–≤—Ç–æ-–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ */      /* ADDED */
.nav.nav--hidden{transform:translateY(28px);opacity:.35}

/* —Å–µ—Ç–∫–∞ –æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –∫–∞–∫ —É —Ç–µ–±—è */
.nav-grid{
  display:grid;
  grid-template-columns:1fr 1fr 1fr 1fr 1fr;
  align-items:center;
  justify-items:center;
  gap:6px;
}

/* –∏–∫–æ–Ω–∫–∏-–ø—Ä—É–∂–∏–Ω–∫–∏ */
.nav-item{
  position:relative;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:2px;
  font-size:11px;
  color:rgba(255,255,255,.65);
  border:none;
  background:none;
  cursor:pointer;
  padding:6px 0;
  transition:.25s cubic-bezier(.2,.8,.3,1.4);  /* ADDED */
}
.nav-item span{margin-top:2px}          /* ADDED */

.nav-item.active{
  color:#fff;
  transform:translateY(-2px) scale(1.04);
}
.nav-item.active::after{
  content:"";
  position:absolute;
  bottom:-2px;
  width:22px;
  height:6px;
  border-radius:999px;
  background:rgba(255,255,255,.9);
  box-shadow:0 0 10px rgba(255,255,255,.9);
}

.nav-center{display:flex;justify-content:center;align-items:center}

/* FAB ‚Äî –º—è–≥–∫–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ */
.fab{
  background:var(--panel-3);
  border-radius:18px;
  padding:12px 14px;
  border:none;
  font-size:20px;
  color:#fff;
  cursor:pointer;
  box-shadow:0 10px 22px rgba(120,60,255,.65);
  transition:.25s ease;
}
.fab:active{transform:scale(1.08)}

.form-group{display:flex;flex-direction:column;gap:6px}
.form-group label{color:var(--muted);font-size:12px}

.input,
.file,
textarea{
  background:linear-gradient(180deg,#10131c,#0b0d12);
  border:1px solid rgba(255,255,255,.18);
  border-radius:14px;
  padding:10px 12px;
  color:#fff;
  outline:none;
  transition:.25s ease;
}
.input:focus,
textarea:focus{
  border-color:#7c7cff;
  box-shadow:0 0 0 4px rgba(124,124,255,.22);
}
#reviewsAdd{margin-top:10px}
/* FIX ‚Äî —É–±—Ä–∞—Ç—å –≤—Å–ø–ª—ã–≤–∞—é—â—É—é –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å –±–∏—Ç" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö */  /* ADDED */
.action-menu{display:none!important}

/* üõí ‚Äî‚Äî‚Äî –î–û–ë–ê–í–õ–ï–ù–û: —Å—Ç–∏–ª–∏ –∫–æ—Ä–∑–∏–Ω—ã ‚Äî‚Äî‚Äî */
.cart-item{position:relative;background:var(--panel-2);border:1px solid var(--border);border-radius:16px;padding:12px;overflow:hidden;transition:.25s ease}
.cart-line{display:flex;justify-content:space-between;align-items:center}
.cart-swipe{position:absolute;right:-90px;top:0;height:100%;display:flex;align-items:center;padding:0 10px}
.cart-delete{background:#ff4d6d;border:none;border-radius:12px;padding:8px 12px;font-weight:900;color:#fff}
.total-box{margin:0 18px 100px;background:var(--panel-2);border:1px solid var(--border);border-radius:16px;padding:14px}
.total-main{display:flex;justify-content:space-between;font-size:16px;font-weight:900}
.checkout{margin-top:10px;width:100%;background:var(--panel-3);;border:none;border-radius:16px;padding:12px 14px;font-weight:900;color:#fff}
.price{font-weight:900}

/* üõí —Å—á—ë—Ç—á–∏–∫ –Ω–∞ –∏–∫–æ–Ω–∫–µ –∫–æ—Ä–∑–∏–Ω—ã */
.cart-badge{
  position:absolute;
  top:-3px;right:-2px;
  background:#ff4d6d;
  color:#fff;
  font-size:10px;
  font-weight:900;
  border-radius:999px;
  padding:2px 6px;
  box-shadow:0 4px 10px rgba(0,0,0,.45);
}

/* –∫–Ω–æ–ø–∫–∞ ¬´–≤ –∫–æ—Ä–∑–∏–Ω—É¬ª –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö */
.add-cart-btn{
  background:var(--panel-3);
  border:none;border-radius:14px;
  padding:6px 10px;
  color:#fff;
  font-weight:900;
  cursor:pointer;
}

/* üóë –∫–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω–µ (–¥–æ–±–∞–≤–ª–µ–Ω–æ) */
.cart-remove-btn{
  background:#ff4d6d;
  border:none;
  border-radius:12px;
  padding:6px 10px;
  font-weight:900;
  color:#fff;
  cursor:pointer;
  margin-left:8px;
}

/* ===== Mini‚Äëapp visual polish (design‚Äëonly) ===== */
:root{
  --glass-light: rgba(255,255,255,.28);
  --glass-dark: rgba(0,0,0,.32);
}
.card-panel, .row, .cart-item{
  box-shadow:
    0 12px 28px rgba(0,0,0,.45),
    inset 0 1px 0 rgba(255,255,255,.25);
}
button, .fab{
  transition: .18s cubic-bezier(.2,.8,.4,1);
  box-shadow:
    0 6px 18px rgba(0,0,0,.35),
    inset 0 1px 0 rgba(255,255,255,.35);
}
button:active, .fab:active{
  transform: scale(.94) translateY(1px);
  box-shadow:
    0 4px 10px rgba(0,0,0,.45),
    inset 0 2px 6px rgba(0,0,0,.25);
}
.glass{
  background: linear-gradient(180deg,rgba(255,255,255,.42),rgba(10,10,12,.38));
  border:1px solid rgba(255,255,255,.28);
  backdrop-filter: blur(22px) saturate(1.35);
}

/* subtle snowfall */
.snow{position:fixed;pointer-events:none;left:0;top:0;width:100%;height:100%;z-index:0}
.snow span{
  position:absolute;
  width:4px;height:4px;border-radius:50%;
  background:rgba(255,255,255,.9);
  opacity:.7;
  animation:fall linear infinite;
}
@keyframes fall{
  from{transform:translateY(-10vh)}
  to{transform:translateY(110vh)}
}


/* ===== Dock icon polish (no square backgrounds) ===== */
.nav-item span, .nav-item svg {
  background:none !important;
}
.nav-item{
  border:none!important;
  background:transparent!important;
}
.nav-item i, .nav-item img{
  background:transparent!important;
}
.nav-item.active{
  filter:drop-shadow(0 4px 10px rgba(0,0,0,.45));
}
/* circular hover ripple */
.nav-item:active{
  transform:scale(.92);
}


/* ===== Fly‚Äëto‚Äëcart animation ===== */
@keyframes flyToCart {
  0%{transform:translate(0,0) scale(1);opacity:1}
  100%{transform:translate(var(--dx),var(--dy)) scale(.35);opacity:0}
}
.fly-clone{
  position:fixed;
  pointer-events:none;
  z-index:9999;
  animation:flyToCart .6s cubic-bezier(.2,.7,.4,1) forwards;
}


/* ===== Parallax profile + blurred beat cards + new profile bg ===== */
.profile-header{
  position:relative;
  overflow:hidden;
}
.profile-bg{
  position:absolute;
  inset:0;
  background:radial-gradient(120% 120% at 50% -10%, #3b5bff 0%, #6f39ff 35%, #0b0f1c 90%);
  filter:blur(12px);
  opacity:.9;
}
.profile-header > *:not(.profile-bg){
  position:relative;
  z-index:2;
}

.card-blur, .row, .cart-item{
  backdrop-filter:blur(18px) saturate(1.35);
  -webkit-backdrop-filter:blur(18px) saturate(1.35);
  background:rgba(20,20,28,.45)!important;
  border:1px solid rgba(255,255,255,.18);
  box-shadow:0 12px 28px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.25);
}

/* parallax motion */
.parallax-wrap{will-change:transform;transition:transform .2s ease-out;}


/* ==== Dock buttons ‚Äî iOS capsule style (no square tiles) ==== */
.nav-grid{gap:0}
.nav-item{
  background:transparent!important;
  border:none!important;
  padding:6px 0!important;
}
.nav-item span{
  background:transparent!important;
}
.nav-item i,
.nav-item img{
  background:transparent!important;
}
.nav-item.active{
  position:relative;
}
.nav-item.active::after{
  content:'';
  position:absolute;
  bottom:-8px;
  left:50%;
  width:28px;
  height:4px;
  border-radius:4px;
  background:#ffffff;
  opacity:.9;
  transform:translateX(-50%);
}

/* center FAB as round capsule */
.fab{
  border-radius:20px!important;
  width:48px;height:48px;
  display:flex;align-items:center;justify-content:center;
}

/* ==== Profile background exactly like reference ==== */
.profile-header{
  position:relative;
  overflow:hidden;
}
.profile-bg{
  position:absolute;
  inset:0;
  background:linear-gradient(180deg,#2b3146 0%,#20263a 35%,#12141c 100%);
  filter:blur(10px);
  opacity:.95;
}
.profile-header > *:not(.profile-bg){
  position:relative;z-index:2;
}


/* === HARD OVERRIDE: profile gradient exactly like reference === */
.profile-header{
  position:relative !important;
  overflow:hidden !important;
}
.profile-header::before{
  content:'';
  position:absolute;
  inset:0;
  background:radial-gradient(120% 140% at 50% -10%, #3f55ff 0%, #2b2f68 45%, #0d0f18 100%) !important;
  filter:blur(6px);
  opacity:.92;
  z-index:0;
}
.profile-header > *{ position:relative; z-index:1; }

/* === HARD OVERRIDE: remove square tiles under dock icons === */
.bottom-nav, .nav-grid{ background:transparent !important; }
.nav-item{
  background:transparent !important;
  border:none !important;
  box-shadow:none !important;
}
.nav-item img, .nav-item svg, .nav-item span{
  background:transparent !important;
}
.nav-item.active::after{
  content:'';
  position:absolute;
  bottom:-10px;
  left:50%;
  width:30px;
  height:4px;
  border-radius:4px;
  background:#fff;
  opacity:.95;
  transform:translateX(-50%);
}


/* === STRICT CARD‚ÄëONLY PROFILE GRADIENT (applied only inside profile card) === */
.profile-hero{
  position:relative !important;
  overflow:hidden !important;
}
.profile-hero::before{
  content:'';
  position:absolute;
  inset:0;
  z-index:0;
  background:radial-gradient(120% 140% at 50% -10%, #3f55ff 0%, #2b2f68 45%, #0d0f18 100%) !important;
  filter:blur(6px);
  opacity:.92;
}
.profile-hero > *{
  position:relative;
  z-index:1;
}


/* === Softer profile gradient + no white borders === */
.profile-hero::before{
  background:radial-gradient(130% 150% at 50% -10%, #2f3f7a 0%, #1e2444 45%, #0a0c14 100%) !important;
  opacity:.78 !important;
  filter:blur(8px) !important;
}
.profile-hero{
  border:none !important;
  box-shadow:0 18px 40px rgba(0,0,0,.42) !important;
}

</style>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

<!--

<script>
(function(){
  const AUTH_KEY="beat_profile";
  const saved = localStorage.getItem(AUTH_KEY);
  const app = document.querySelector(".screen");
  if(!saved && app){ app.style.display="none"; }
  if(saved){
    const p = JSON.parse(saved||"{}");
    applyProfileFromAuth?.(p);
    document.getElementById("authOverlay")?.remove();
  }
})();
</script>
 ===== TELEGRAM / EMAIL AUTH (FIRST RUN) ===== -->
<div id="authOverlay" style="position:fixed;inset:0;background:#0a0b10;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:99999;padding:18px">
  <div style="max-width:420px;width:100%" class="card-panel">
    <h2 style="margin-top:0">–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
    <button id="btnTgAuth" class="submit soft">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram</button>
    <div style="opacity:.6;text-align:center;margin:10px 0">–∏–ª–∏</div>
    <div class="form-group"><label>Email</label><input id="regEmail" class="input" type="email"></div>
    <div class="form-group"><label>–ü–∞—Ä–æ–ª—å</label><input id="regPass" class="input" type="password"></div>
    <button class="submit soft" onclick="startEmailVerify()">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
    <div id="codeBox" style="display:none;margin-top:10px">
      <div class="form-group"><label>–ö–æ–¥ –∏–∑ –ø–∏—Å—å–º–∞</label><input id="codeInput" class="input"></div>
      <button class="submit soft" onclick="finishEmailVerify()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
      <div id="codeHint" style="opacity:.6;font-size:12px;margin-top:4px"></div>
    </div>
  </div>
</div>

<div class="screen">
<header class="top-bar"><div class="brand">B–ÅAT</div><div class="balance">‚ÇΩ <span id="balance">17</span><button onclick="openPage('topup')">Ôºã</button></div></header>

<!-- HOME / –ö–ê–¢–ê–õ–û–ì -->
<div id="page-home" class="page active fade">
  <div class="chip-row">
    <div class="chip active" data-filter="all">–í—Å–µ</div>
    <div class="chip" data-filter="hits">üî• –•–∏—Ç—ã</div>
    <div class="chip" data-filter="lofi">üéß Lo-Fi</div>
    <div class="chip" data-filter="trap">üéπ Trap</div>
  </div>
  <div class="section-title">–ö–∞—Ç–∞–ª–æ–≥</div>
  <div id="catalog" class="list"></div>
</div>

<!-- PROFILE PAGE -->
<div id="page-profile" class="page fade">
  <div class="profile-hero glass shadow">
    <div class="profile-top">
      <div class="p-avatar"><img id="pubAvatar"></div>
      <div class="p-name" id="pubName">Nidllz</div>
      <div class="p-stats">
        <div class="stat"><strong id="sFollowers">0</strong><span>–ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</span></div>
        <div class="stat"><strong id="sPlays">0</strong><span>–ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–π</span></div>
        <div class="stat"><strong id="sLikes">0</strong><span>–ª–∞–π–∫–æ–≤</span></div>
      </div>

      <!-- ‚¨á –ö–ù–û–ü–ö–ê ¬´–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è¬ª –£–î–ê–õ–ï–ù–ê -->
      <div class="p-actions">
        <button class="btn-secondary soft" onclick="openPage('settings')">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
        <button class="btn-ghost soft">üîó</button>
      </div>

      <div id="bio" class="bio">–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è</div>
      <div id="contact" class="contact-pill">@username</div>
    </div>
  </div>

  <div class="tabs">
    <div class="tab active" data-tab="beatsTab">–ë–∏—Ç—ã (<span id="beatsCount">0</span>)</div>
    <div class="tab" data-tab="reviewsTab">–û—Ç–∑—ã–≤—ã (<span id="reviewsCount">0</span>)</div>
  </div>

  <div id="beatsTab" class="list"></div>
  <div id="reviewsTab" class="list" style="display:none"></div>

  <div id="reviewsAdd" class="card-panel" style="display:none">
    <div class="form-group"><label class="muted">–ò–º—è</label><input id="rName" class="input"></div>
    <div class="form-group"><label class="muted">–û—Ü–µ–Ω–∫–∞ (1‚Äì5)</label><input id="rStars" type="number" min="1" max="5" class="input"></div>
    <div class="form-group"><label class="muted">–û—Ç–∑—ã–≤</label><textarea id="rText" class="input" style="min-height:70px"></textarea></div>
    <button class="submit soft" onclick="addReview()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –æ—Ç–∑—ã–≤</button>
  </div>
</div>

<!-- SETTINGS PAGE -->
<div id="page-settings" class="page fade">
  <div class="page-header">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</div>
  <div class="card-panel">
    <div class="form-group"><label class="muted">–ò–º—è</label><input id="username" class="input"></div>
    <div class="form-group"><label class="muted">–ê–≤–∞—Ç–∞—Ä</label><input id="avatarFile" type="file" class="file" accept="image/*" onchange="setAvatar()"></div>
    <div class="form-group"><label class="muted">–ë–∏–æ–≥—Ä–∞—Ñ–∏—è</label><textarea id="bioInput" class="input" style="min-height:70px"></textarea></div>
    <div class="form-group"><label class="muted">–ö–æ–Ω—Ç–∞–∫—Ç</label><input id="contactInput" class="input" placeholder="@telegram"></div>
    <button class="submit soft" onclick="saveProfile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  </div>
</div>

<!-- –ö–û–†–ó–ò–ù–ê -->
<div id="page-cart" class="page fade">
  <div class="page-header">–ö–æ—Ä–∑–∏–Ω–∞</div>
  <div id="cartList" class="list"></div>

  <div class="total-box">
    <div class="total-main">
      –ò—Ç–æ–≥–æ: ‚ÇΩ<span id="totalSum">0</span>
    </div>
    <button class="checkout" onclick="checkout()">–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ</button>
  </div>
</div>

<!-- FAVORITES -->
<div id="page-fav" class="page fade">
  <div class="page-header">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</div>
  <div id="favList" class="list"></div>
</div>

<!-- ADD PAGE -->
<div id="page-add" class="page fade">
  <div class="page-header">–î–æ–±–∞–≤–∏—Ç—å –±–∏—Ç</div>
  <div class="card-panel">
    <div class="form-group"><label class="muted">–ù–∞–∑–≤–∞–Ω–∏–µ</label><input id="fTitle" class="input"></div>
    <div class="form-group"><label class="muted">BPM / –°—Ç–∏–ª—å</label><input id="fTag" class="input"></div>
    <div class="form-group"><label class="muted">–¶–µ–Ω–∞ (‚ÇΩ)</label><input id="fPrice" type="number" class="input"></div>
    <div class="form-group"><label class="muted">–ê—É–¥–∏–æ-—Ñ–∞–π–ª</label><input id="fAudio" type="file" class="file" accept="audio/*"></div>
    <div class="form-group"><label class="muted">–û–±–ª–æ–∂–∫–∞</label><input id="fCover" type="file" class="file" accept="image/*"></div>
    <button class="submit soft" onclick="publishBeat()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
  </div>
</div>

<!-- TOPUP -->
<div id="page-topup" class="page fade">
  <div class="page-header">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</div>
  <div class="card-panel">
    <div class="form-group"><label class="muted">–°—É–º–º–∞</label><input id="topupAmount" type="number" class="input"></div>
    <button class="submit soft" onclick="pay('sbp')">–°–ë–ü</button>
    <button class="submit soft" onclick="pay('card')">–ö–∞—Ä—Ç–∞</button>
    <button class="submit soft" onclick="pay('crypto')">Crypto</button>
  </div>
</div>

<!-- NAV -->
<nav class="nav glass"><div class="nav-grid">
<button class="nav-item active" onclick="openPage('home',this)">üè†<span>–ì–ª–∞–≤–Ω–∞—è</span></button>
<button class="nav-item" onclick="openPage('cart',this)" id="cartTabBtn" style="position:relative">üõí<span>–ö–æ—Ä–∑–∏–Ω–∞</span><span id="cartBadge" class="cart-badge" style="display:none">0</span></button>
<div class="nav-center"><button class="fab soft" onclick="openPage('add')">Ôºã</button></div>
<button class="nav-item" onclick="openPage('fav',this)">‚ù§Ô∏è<span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span></button>
<button class="nav-item" onclick="openPage('profile',this)">üë§<span>–ü—Ä–æ—Ñ–∏–ª—å</span></button>
</div></nav>

<div id="actionMenu" class="action-menu"><div class="action-sheet shadow"><button class="sheet-btn" onclick="openPage('add');">‚ûï –î–æ–±–∞–≤–∏—Ç—å –±–∏—Ç</button></div></div>
</div>

<script>
let lastY=0;
window.addEventListener("scroll",()=>{
  const nav=document.querySelector(".nav");
  const y=window.scrollY;
  if(y>lastY+6) nav.classList.add("nav--hidden");
  else nav.classList.remove("nav--hidden");
  lastY=y;
});
function openPage(page,el){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));const n=document.getElementById('page-'+page);if(n)n.classList.add('active');document.querySelectorAll('.nav-item').forEach(x=>x.classList.remove('active'));if(el)el.classList.add('active');if(page==='profile')renderPublicProfile();if(page==='beats')renderBeatsPage();if(page==='fav')renderFav();if(page==='home')renderCatalog();}

/* DATA */
const beats=[];const favorites=[];let profile={username:'Nidllz',avatar:'',bio:'–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è',contact:'@username',stats:{followers:85,plays:6400,likes:1100},reviews:[]};

/* CHIPS / FILTERS */
function renderCatalog(){document.getElementById('catalog').innerHTML=beats.map((b,i)=>beatRow(b,i,true)).join('');applyFilter();}
function applyFilter(){const active=document.querySelector('.chip.active')?.dataset.filter||'all';document.querySelectorAll('#catalog .row').forEach(r=>{r.style.display=(active==='all'||r.dataset.type===active)?'grid':'none';});}
document.querySelectorAll('.chip').forEach(ch=>ch.addEventListener('click',()=>{document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));ch.classList.add('active');applyFilter();}));

/* ROW TEMPLATE */
function beatRow(b,index,withLike){return `<div class=\"row fade\" data-type=\"${b.type}\"><img src=\"${b.cover}\"><div class=\"row-body\"><div class=\"row-title\">${b.title}</div><div class=\"row-tag\">${b.tag}</div><div class=\"row-foot\">${withLike?`<button class=\"icon-btn like ${b.fav?'active':''}\" onclick=\"toggleFav(${index});event.stopPropagation()\">‚ô°</button>`:''}<span>‚ÇΩ${b.price}</span></div></div></div>`;}

/* BEATS RENDER */
function renderBeatsTab(){document.getElementById('beatsTab').innerHTML=beats.map((b,i)=>beatRow(b,i,true)).join('');document.getElementById('beatsCount').textContent=beats.length;}
function renderBeatsPage(){document.getElementById('beatsList').innerHTML=beats.map((b,i)=>beatRow(b,i,true)).join('');}

/* FAVORITES */
function toggleFav(i){beats[i].fav=!beats[i].fav;if(beats[i].fav){favorites.unshift(beats[i]);}else{const idx=favorites.indexOf(beats[i]);if(idx>-1)favorites.splice(idx,1);}renderBeatsTab();renderBeatsPage();renderFav();renderCatalog();}
function renderFav(){document.getElementById('favList').innerHTML=favorites.length?favorites.map(b=>beatRow(b,0,false)).join(''):'<div class=\"card-panel muted\">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ –ø—É—Å—Ç–æ</div>';}

/* REVIEWS */
function renderReviews(){document.getElementById('reviewsTab').innerHTML=profile.reviews.length?profile.reviews.map(r=>`<div class=\"review fade\"><div class=\"review-top\"><div class=\"review-user\">${r.user}</div><div class=\"stars\">${'‚òÖ'.repeat(r.rating)}${'‚òÜ'.repeat(5-r.rating)}</div></div><div class=\"review-text\">${r.text}</div></div>`).join(''):'<div class=\"muted\">–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤</div>';document.getElementById('reviewsCount').textContent=profile.reviews.length;}
function addReview(){const user=rName.value.trim()||'–ì–æ—Å—Ç—å';const stars=parseInt(rStars.value)||0;const txt=rText.value.trim();if(!txt||stars<1||stars>5)return;profile.reviews.unshift({user,rating:stars,text:txt});rName.value=rStars.value=rText.value='';renderReviews();}

/* PROFILE */
function renderPublicProfile(){pubName.textContent=profile.username;pubAvatar.src=profile.avatar||'';bio.textContent=profile.bio||'';contact.textContent=profile.contact||'';sFollowers.textContent=profile.stats.followers;sPlays.textContent=profile.stats.plays;sLikes.textContent=profile.stats.likes;renderBeatsTab();renderReviews();}

document.querySelectorAll('.tab').forEach(t=>t.addEventListener('click',()=>{document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));t.classList.add('active');const isBeats=t.dataset.tab==='beatsTab';document.getElementById('beatsTab').style.display=isBeats?'flex':'none';document.getElementById('reviewsTab').style.display=isBeats?'none':'flex';document.getElementById('reviewsAdd').style.display=isBeats?'none':'block';}));

/* SETTINGS */
function setAvatar(){const f=avatarFile.files[0];if(!f)return;profile.avatar=URL.createObjectURL(f);} 
function saveProfile(){profile.username=username.value||profile.username;profile.bio=bioInput.value||'';profile.contact=contactInput.value||'';renderPublicProfile();alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');}

/* ADD BEAT */
function publishBeat(){const title=fTitle.value.trim();const tag=fTag.value.trim();const price=fPrice.value||'0';const a=fAudio.files[0];const c=fCover.files[0];if(!title||!a||!c){alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è');return;}const type=tag.toLowerCase().includes('trap')?'trap':tag.toLowerCase().includes('lo')?'lofi':'hits';beats.unshift({title,tag,price,fav:false,type,cover:URL.createObjectURL(c)});fTitle.value=fTag.value=fPrice.value='';fAudio.value=fCover.value='';renderCatalog();renderPublicProfile();openPage('beats');}

/* TOPUP */
function pay(type){alert('–û–ø–ª–∞—Ç–∞: '+type);}

// seed demo
beats.push({title:'–ë–∏—Ç 1',tag:'110 BPM ‚Ä¢ Fmin',price:'2500',fav:false,type:'hits',cover:'https://picsum.photos/seed/kami/200/200'});
renderCatalog();renderPublicProfile();
/* üõí ‚Äî‚Äî‚Äî –î–û–ë–ê–í–õ–ï–ù–û: –ª–æ–≥–∏–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã ‚Äî‚Äî‚Äî */
const cart=[];

function addBeatToCart(index){
  const item = {...beats[index]};
  cart.push(item);
  saveCart();
  renderCart();
}

let startX=null;
function swipeStart(e){ startX=e.touches[0].clientX; }
function swipeMove(e,idx){
  const dx=e.touches[0].clientX-startX;
  const el=e.currentTarget;
  if(dx<-20) el.style.transform=`translateX(${dx}px)`;
}
function swipeEnd(e,idx){
  const dx=e.changedTouches[0].clientX-startX;
  const el=e.currentTarget;
  if(dx<-80){ removeFromCart(idx); }
  else el.style.transform='translateX(0)';
}

function removeFromCart(i){
  cart.splice(i,1);
  saveCart();
  renderCart();
}

function renderCart(){
  const box=document.getElementById("cartList");
  if(!box) return;

  if(!cart.length){
    box.innerHTML="<div class='card-panel'>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>";
    document.getElementById("totalSum").textContent="0";
    updateCartBadge();
    return;
  }

  let total=0;
  box.innerHTML = cart.map((c,i)=>{
    total+=+c.price||0;
    return `
    <div class="cart-item"
      ontouchstart="swipeStart(event)"
      ontouchmove="swipeMove(event,${i})"
      ontouchend="swipeEnd(event,${i})">
      <div class="cart-line">
        <div>${c.title||'–¢–æ–≤–∞—Ä'}</div>
        <div class="price">‚ÇΩ${c.price}</div>
      </div>
      <div class="cart-swipe">
        <button class="cart-delete" onclick="removeFromCart(${i})">–£–¥–∞–ª–∏—Ç—å</button>
      </div>
    </div>`;
  }).join("");

  document.getElementById("totalSum").textContent = total;
  updateCartBadge();
}

function saveCart(){
  localStorage.setItem("cart", JSON.stringify(cart));
}

/* üî¢ —Å—á—ë—Ç—á–∏–∫ –Ω–∞ –∏–∫–æ–Ω–∫–µ */
function updateCartBadge(){
  const badge=document.getElementById("cartBadge");
  if(!badge) return;
  if(cart.length===0){
    badge.style.display="none";
  } else {
    badge.style.display="inline-block";
    badge.textContent=cart.length;
  }
}

function checkout(){
  alert("–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ: ‚ÇΩ"+document.getElementById("totalSum").textContent);
}

const _oldBeatRow = beatRow;
beatRow = function(b,index,withLike){
  const html = _oldBeatRow(b,index,withLike);
  return html.replace(
    '</div></div></div>',
    `<button class="add-cart-btn" onclick="addBeatToCart(${index});event.stopPropagation()">–í –∫–æ—Ä–∑–∏–Ω—É</button></div></div></div>`
  );
};

/* ===== Snow particles (design‚Äëonly) ===== */
(function(){
  const c=document.getElementById("snow"); if(!c) return;
  const N=36;
  for(let i=0;i<N;i++){
    const s=document.createElement("span");
    s.style.left=Math.random()*100+"%";
    s.style.animationDuration= (6+Math.random()*6)+"s";
    s.style.animationDelay= (Math.random()*6)+"s";
    c.appendChild(s);
  }
})();


/* ===== Fly‚Äëto‚Äëcart effect (design only, logic unchanged) ===== */
window.flyToCart = function(el){
  try{
    const cart = document.getElementById("cartTabBtn");
    if(!cart) return;
    const r1 = el.getBoundingClientRect();
    const r2 = cart.getBoundingClientRect();
    const clone = el.cloneNode(true);
    clone.classList.add("fly-clone");
    document.body.appendChild(clone);
    const dx = (r2.left+r2.width/2) - (r1.left+r1.width/2);
    const dy = (r2.top+r2.height/2) - (r1.top+r1.height/2);
    clone.style.setProperty("--dx", dx+"px");
    clone.style.setProperty("--dy", dy+"px");
    clone.style.left = r1.left+"px";
    clone.style.top  = r1.top+"px";
    setTimeout(()=>clone.remove(),650);
  }catch(e){}
};

/* wrap addBeatToCart to trigger animation */
if(typeof addBeatToCart === "function"){
  const __add = addBeatToCart;
  addBeatToCart = function(i,ev){
    if(ev && ev.currentTarget) flyToCart(ev.currentTarget);
    __add(i);
  };
}


/* ===== Parallax scroll on profile header ===== */
(function(){
  const p = document.querySelector('.parallax-wrap');
  if(!p) return;
  window.addEventListener('scroll', ()=>{
    const y = window.scrollY*0.35;
    p.style.transform = `translateY(${y}px)`;
  }, {passive:true});
})();

</script>

<div class="snow" id="snow"></div>


<script>
/* ===== REAL TELEGRAM WEBAPP AUTH + PROFILE PERSISTENCE ===== */
const AUTH_KEY = "beat_profile";
const tg = window.Telegram?.WebApp;

/* apply profile to existing UI */
window.applyProfileFromAuth = function(p){
  try{
    if(p.username) { profile.username = p.username; }
    if(p.bio) profile.bio = profile.bio || "";
    if(document.getElementById("username")) username.value = profile.username;
    if(document.getElementById("pubName")) pubName.textContent = profile.username;
  }catch(e){}
};

/* Telegram login */
document.getElementById("btnTgAuth").onclick = function(){
  try{
    if(!tg || !tg.initDataUnsafe || !tg.initDataUnsafe.user){
      alert("–û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤–Ω—É—Ç—Ä–∏ Telegram (WebApp)"); return;
    }
    const u = tg.initDataUnsafe.user;
    const prof = {
      id: u.id,
      username: (u.first_name||"") + (u.last_name?(" "+u.last_name):""),
      tg_user: u.username||"",
      source:"telegram"
    };
    localStorage.setItem(AUTH_KEY, JSON.stringify(prof));
    applyProfileFromAuth(prof);
    document.getElementById("authOverlay")?.remove();
    document.querySelector(".screen")?.style.removeProperty("display");
  }catch(e){ console.error(e); alert("–û—à–∏–±–∫–∞ Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"); }
};

/* ===== EMAIL REGISTRATION (CODE DEMO, BACKEND HOOK POINT) ===== */
let generatedCode=null;
function startEmailVerify(){
  const email = regEmail.value.trim();
  const pass  = regPass.value.trim();
  if(!email||!pass){ alert("–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å"); return; }

  // ‚ñº‚ñº‚ñº –¢–û–ß–ö–ê –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø –ö –ë–≠–ö–ï–ù–î–£ –û–¢–ü–†–ê–í–ö–ò –ö–û–î–ê ‚ñº‚ñº‚ñº
  // fetch("/api/send_code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email})})
  //   .then(r=>r.json()).then(d=>{ generatedCode=d.code; codeBox.style.display="block"; });

  // Demo (–±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞)
  generatedCode = String(Math.floor(100000+Math.random()*900000));
  codeBox.style.display="block";
  codeHint.textContent = "–î–µ–º–æ‚Äë–∫–æ–¥: "+generatedCode;
}

function finishEmailVerify(){
  if(codeInput.value.trim() !== generatedCode){ alert("–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥"); return; }

  const prof = {
    id:"local_"+Date.now(),
    username: regEmail.value.trim(),
    source:"email"
  };
  localStorage.setItem(AUTH_KEY, JSON.stringify(prof));
  applyProfileFromAuth(prof);
  document.getElementById("authOverlay")?.remove();
  document.querySelector(".screen")?.style.removeProperty("display");
}
</script>

</body>
</html>
